<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.kindergarten.admin.mapper.AdminMapper">

    <resultMap id="AdminMap" type="com.great.kindergarten.commons.entity.TblAdmin">
        <result column="adminid" property="adminid"/>
        <result column="adminname" property="adminname"/>
        <result column="adminpwd" property="adminpwd"/>
        <result column="createtime" property="createtime"/>
        <result column="adminstatus" property="adminstatus"/>
        <result column="rid" property="rid"/>
    </resultMap>

    <!--    用户状态查询-->
    <select id="findAdminStatus" resultType="java.lang.String" parameterType="java.util.Map">
        select adminstatus from tbl_admin
        <where>
            <if test="adminname != '' and adminname != null ">
                and adminname = #{adminname}
            </if>
        </where>
    </select>

    <!--    用户登录-->
    <select id="adminLogin" resultMap="AdminMap" parameterType="java.util.Map">
        select * from tbl_admin
        <where>
            <if test="adminname != '' and adminname != null ">
                and adminname = #{adminname}
            </if>
            <if test="adminpwd != '' and adminpwd != null ">
                and adminpwd = #{adminpwd}
            </if>
        </where>
    </select>

    <select id="findMenuByName" resultType="com.great.kindergarten.commons.entity.TblMenu" parameterType="string">
		select *
		from tbl_menu
		where menuid in (
			select mid
			from tbl_rolemenu R1
			where R1.rid in
				  (select R.roleid
				   from tbl_role R
							left join tbl_admin A on R.roleid = A.rid
				   where A.adminname = #{adminname} and menusonid = 0)
		)
	</select>

    <select id="findMenuBySid" resultType="com.great.kindergarten.commons.entity.TblMenu" parameterType="java.lang.Integer">
        select * from tbl_menu a, tbl_rolemenu b where a.menusonid = #{menusonid} and a.menuid = b.mid
    </select>

    <select id="findRoleByRid" resultType="java.lang.String">
        select rolename from tbl_role where roleid = #{roleid}
    </select>
    <select id="findAdminByName" resultType="com.great.kindergarten.commons.entity.TblAdmin">
        select * from tbl_admin where adminname = #{adminname}
    </select>

    <select id="findTblAdminByName" resultType="com.great.kindergarten.commons.entity.TblAdmin">
        select * from tbl_admin where adminname = #{adminname}
    </select>

    <update id="updateAdminPwd" parameterType="java.util.Map">
        update tbl_admin set adminpwd = #{adminpwd} where adminid = #{adminid};
    </update>
    <update id="checkQualify">
        update tbl_kinder
        <set>
            <if test="kinderstatus != '' and kinderstatus != null">
                kinderstatus = #{kinderstatus},
            </if>
            <if test="kinderapptime != '' and kinderapptime != null">
                kinderapptime = #{kinderapptime},
            </if>
        </set>
        where kinderid = #{kinderid}
    </update>

    <select id="findAllKinder" resultType="com.great.kindergarten.commons.entity.TblKinder">
        select * from tbl_kinder
        <where>
            <if test=" time1 != '' and time1 != null">
                <![CDATA[   and DATE_FORMAT(kinderregtime, '%Y-%m-%d')>=  DATE_FORMAT(#{time1}, '%Y-%m-%d')   ]]>
            </if>
            <if test=" time2 != '' and time2 != null">
                <![CDATA[   and DATE_FORMAT(kinderregtime, '%Y-%m-%d')<=  DATE_FORMAT(#{time2}, '%Y-%m-%d')   ]]>
            </if>
            <if test=" kindername != '' and kindername != null">
                and kindername like concat('%',#{kindername},'%')
            </if>
            <if test=" kinderstatus != '' and kinderstatus != null and kinderstatus !='请选择'">
                and kinderstatus = #{kinderstatus}
            </if>
        </where>
        order by kinderregtime desc
    </select>

    <select id="findAllCount" resultType="java.lang.Integer">
        select count(*) from tbl_kinder
        <where>
            <if test="time1!= '' and time1 != null">
                <![CDATA[   and DATE_FORMAT(kinderregtime, '%Y-%m-%d')>=  DATE_FORMAT(#{time1}, '%Y-%m-%d')   ]]>
            </if>
            <if test="time2!= '' and time2 != null">
                <![CDATA[   and DATE_FORMAT(kinderregtime, '%Y-%m-%d')<=  DATE_FORMAT(#{time2}, '%Y-%m-%d')   ]]>
            </if>
            <if test=" kindername != '' and kindername != null">
                and kindername like concat('%',#{kindername},'%')
            </if>
            <if test=" kinderstatus != '' and  kinderstatus != null and kinderstatus !='请选择'">
                and kinderstatus = #{kinderstatus}
            </if>
            <if test=" kindercode != '' and  kindercode != null and kindercode !='请选择'">
                and kindercode = #{kindercode}
            </if>
        </where>
    </select>
    <select id="findTblKinderById" resultType="com.great.kindergarten.commons.entity.TblKinder">
        select * from tbl_kinder where kinderid = #{kinderid}
    </select>
    <select id="findKinder" resultType="com.great.kindergarten.commons.entity.TblKinder">
        select * from tbl_kinder
    </select>

    <!--    &lt;!&ndash;    查找用户类型&ndash;&gt;-->
<!--    <select id="findUserType" parameterType="java.lang.String" resultMap="userMap">-->
<!--                select r.roleid,r.rolename from usertable u join roletable r on(u.roleid = r.roleid)-->
<!--                where u.username = #{username}-->
<!--            </select>-->

<!--    &lt;!&ndash;    这边这个type是你需要查询返回的对象，id就是select语句的 resultMap&ndash;&gt;-->
<!--    <resultMap id="userMap" type="RoleTable">-->
<!--        &lt;!&ndash;   这边填写的是你需要查询的的结果&ndash;&gt;-->
<!--        <result property="roleid" column="roleid"/>-->
<!--        <result property="rolename" column="rolename"/>-->
<!--        &lt;!&ndash;    需要的条件，即where 后面的条件（属于那个实体对象，下面的property就填哪个，column就是实体对象对应数据库表的字段名，-->
<!--        javaType就是查询条件的实体类）&ndash;&gt;-->
<!--        <association property="userTable" column="roleid" javaType="UserTable">-->
<!--            &lt;!&ndash;    根据哪个字段去查&ndash;&gt;-->
<!--            <result property="username" column="username"/>-->
<!--        </association>-->
<!--    </resultMap>-->

<!--    &lt;!&ndash;select * from menutable where menuid in (select r2.mid from roletable r1, rolemenutable r2 where r1.roleid = r2.rid and r1.roleid = #{roleid}) and menusonid = 0&ndash;&gt;-->

<!--    &lt;!&ndash;    查找用户对应的父菜单&ndash;&gt;-->
<!--    <select id="findMenuIDByName" parameterType="java.lang.Integer" resultType="MenuTable">-->
<!--        select m.menuid,m.menuname,m.menuurl,m.menusonid,r2.roleid from menutable m,rolemenutable r1,roletable r2 where m.menuid = r1.mid and r1.rid = r2.roleid and r2.roleid = #{roleid} and menusonid = 0;-->
<!--    </select>-->

<!--    &lt;!&ndash;    查找用户对应的子菜单&ndash;&gt;-->
<!--    <select id="findMenuNameByID" parameterType="com.example.papersmagboot.javabean.MenuTable" resultType="MenuTable">-->
<!--        select * from menutable m,rolemenutable r  where  m.menuid = r.mid and   m.menusonid = #{menuid} and r.rid = #{roleid} order by menuid-->
<!--    </select>-->

<!--    &lt;!&ndash;    查找角色信息&ndash;&gt;-->
<!--    <select id="findRoleInfo" resultType="com.example.papersmagboot.javabean.RoleTable"-->
<!--            parameterType="com.example.papersmagboot.javabean.MenuPage">-->
<!--        select * from roletable-->
<!--        <where>-->
<!--            <if test="roleName != '' and roleName != null ">-->
<!--                and rolename like CONCAT('%',#{roleName},'%')-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->

<!--    &lt;!&ndash;    查找角色信息总条数&ndash;&gt;-->
<!--    <select id="findRoleInfoCount" resultType="java.lang.Long"-->
<!--            parameterType="com.example.papersmagboot.javabean.MenuPage">-->
<!--        select count(*) from roletable-->
<!--        <where>-->
<!--            <if test="roleName != '' and roleName != null ">-->
<!--                and rolename like CONCAT('%',#{roleName},'%')-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->


<!--    &lt;!&ndash;    用户管理信息表&ndash;&gt;-->
<!--    <select id="findALLUser" resultMap="UserMap" parameterType="com.example.papersmagboot.javabean.UserPage">-->
<!--        select * from usertable-->
<!--        <where>-->
<!--            <if test="uName != '' and uName != null ">-->
<!--                and username like CONCAT('%',#{uName},'%')-->
<!--            </if>-->
<!--            <if test="uSex != '' and uSex != null ">-->
<!--                and usersex = #{uSex}-->
<!--            </if>-->
<!--            <if test="uStatus != '' and uStatus != null ">-->
<!--                and userstatus = #{uStatus}-->
<!--            </if>-->
<!--            <if test="uTime1 != '' and uTime1 != null and uTime2 != '' and uTime2 != null ">-->
<!--                and userregtime between #{uTime1} and #{uTime2}-->
<!--            </if>-->
<!--        </where>-->
<!--        limit #{page},#{limit}-->
<!--    </select>-->

<!--    &lt;!&ndash;    用户管理信息表,查询记录条数&ndash;&gt;-->
<!--    <select id="findUserInfoCount" resultType="java.lang.Long"-->
<!--            parameterType="com.example.papersmagboot.javabean.UserPage">-->
<!--        select count(*) from usertable-->
<!--        <where>-->
<!--            <if test="uName != '' and uName != null ">-->
<!--                and username like CONCAT('%',#{uName},'%')-->
<!--            </if>-->
<!--            <if test="uSex != '' and uSex != null ">-->
<!--                and usersex = #{uSex}-->
<!--            </if>-->
<!--            <if test="uStatus != '' and uStatus != null ">-->
<!--                and userstatus = #{uStatus}-->
<!--            </if>-->
<!--            <if test="uTime1 != '' and uTime1 != null and uTime2 != '' and uTime2 != null ">-->
<!--                and userregtime between #{uTime1} and #{uTime2}-->
<!--            </if>-->

<!--        </where>-->
<!--    </select>-->

<!--    <update id="updateUserStatus" parameterType="com.example.papersmagboot.javabean.UserTable">-->
<!--        update usertable-->
<!--        <trim prefix="set" suffixOverrides=",">-->
<!--            <if test="userstatus != null ">userstatus = #{userstatus},</if>-->
<!--        </trim>-->
<!--        <where>-->
<!--            userid = #{userid}-->
<!--        </where>-->
<!--    </update>-->

<!--    <update id="updateUserInfo" parameterType="com.example.papersmagboot.javabean.UserTable">-->
<!--        update usertable-->
<!--        <trim prefix="set" suffixOverrides=",">-->
<!--            <if test="username != null ">username = #{username},</if>-->
<!--            <if test="userphone != null ">userphone = #{userphone},</if>-->
<!--            <if test="useremail != null ">useremail = #{useremail},</if>-->
<!--        </trim>-->
<!--        <where>-->
<!--            userid = #{userid}-->
<!--        </where>-->
<!--    </update>-->

<!--    <update id="deleteUser" parameterType="java.lang.String">-->
<!--        UPDATE usertable SET userstatus = '已删除' where userid = #{userid};-->
<!--    </update>-->


<!--    &lt;!&ndash;    查找用户信息&ndash;&gt;-->
<!--    <select id="findAllUserInfo" resultType="com.example.papersmagboot.javabean.UserTable" parameterType="java.lang.Integer">-->
<!--                select * from usertable where userid = #{userid}-->
<!--            </select>-->

<!--    &lt;!&ndash;    查找用户积分信息&ndash;&gt;-->
<!--    <select id="findUserScore" resultType="java.lang.Integer" parameterType="java.lang.Integer">-->
<!--                select userscore from usertable where userid = #{userid}-->
<!--            </select>-->

<!--    <update id="updateUserScore" parameterType="com.example.papersmagboot.javabean.UserTable">-->
<!--        update usertable-->
<!--        <trim prefix="set" suffixOverrides=",">-->
<!--            <if test="userscore != null ">userscore = #{userscore},</if>-->
<!--        </trim>-->
<!--        <where>-->
<!--            userid = #{userid}-->
<!--        </where>-->
<!--    </update>-->

<!--&lt;!&ndash;    用户文档查询&ndash;&gt;-->

<!--    <select id="findUserFile" resultMap="FileMap" parameterType="com.example.papersmagboot.javabean.UserFilePage">-->
<!--        select f1.fileid,f1.filename,f1.filesize,f1.filetime,f1.fileintegral,f1.fileuploadnum,f2.typename,f1.filestatus from filetable f1 left join filetypetable f2 on f1.ftid = f2.typeid-->
<!--        <where>-->
<!--            <if test="fileopname != '' and fileopname != null ">-->
<!--                and f1.fileopname = #{fileopname}-->
<!--            </if>-->

<!--            <if test="fileType != '' and fileType != null ">-->
<!--                and f1.ftid = #{fileType}-->
<!--            </if>-->

<!--            <if test="filestatus != '' and filestatus != null ">-->
<!--                and f1.filestatus = #{filestatus}-->
<!--            </if>-->

<!--            <if test="fileTime1 != '' and fileTime1 != null and fileTime2 != '' and fileTime2 != null ">-->
<!--                and f1.filetime between #{fileTime1} and #{fileTime2}-->
<!--            </if>-->

<!--        </where>-->
<!--        limit #{page},#{limit}-->
<!--    </select>-->


<!--    &lt;!&ndash;    用户文档查询,查询记录条数&ndash;&gt;-->
<!--    <select id="findUserFileInfoCount" resultType="java.lang.Long" parameterType="com.example.papersmagboot.javabean.UserFilePage">-->
<!--        select count(*) from filetable f1 left join filetypetable f2 on f1.ftid = f2.typeid-->
<!--        <where>-->

<!--            <if test="fileopname != '' and fileopname != null ">-->
<!--                and f1.fileopname = #{fileopname}-->
<!--            </if>-->


<!--            <if test="fileType != '' and fileType != null ">-->
<!--                and f1.ftid = #{fileType}-->
<!--            </if>-->

<!--            <if test="filestatus != '' and filestatus != null ">-->
<!--                and f1.filestatus = #{filestatus}-->
<!--            </if>-->

<!--            <if test="fileTime1 != '' and fileTime1 != null and fileTime2 != '' and fileTime2 != null ">-->
<!--                and f1.filetime between #{fileTime1} and #{fileTime2}-->
<!--            </if>-->
<!--        </where>-->
<!--    </select>-->

<!--    &lt;!&ndash;    积分表收入支出表添加&ndash;&gt;-->
<!--    <insert id="addIntegral" parameterType="java.util.List">-->
<!--        insert into-->
<!--        integraltable(integraltype,integralnum,integraltime,uid)-->
<!--        values-->
<!--        <foreach collection="list" item="i" index="index" separator=",">-->
<!--            (#{i.integraltype},#{i.integralnum},#{i.integraltime},#{i.uid})-->
<!--        </foreach>-->
<!--    </insert>-->

<!--&lt;!&ndash;    用户积分收支记录查询&ndash;&gt;-->
<!--    <resultMap id="IntegralMap" type="com.example.papersmagboot.javabean.UserIntegral">-->
<!--        <result column="integralid" property="integralid"></result>-->
<!--        <result column="integraltype" property="integraltype"></result>-->
<!--        <result column="integralnum" property="integralnum"></result>-->
<!--        <result column="integraltime" property="integraltime"></result>-->
<!--        <result column="username" property="username"></result>-->
<!--        <association property="userTable" javaType="com.example.papersmagboot.javabean.UserTable">-->
<!--            <id property="userid" column="userid"/>-->
<!--            <result property="username" column="username"/>-->
<!--        </association>-->
<!--    </resultMap>-->

<!--    <select id="showUserIntegralInfo" resultMap="IntegralMap" parameterType="com.example.papersmagboot.javabean.UserIntegralPage">-->
<!--        select in1.integralid,in1.integraltype,in1.integralnum,in1.integraltime,u.username from integraltable in1 left join usertable u on in1.uid = u.userid limit #{page},#{limit}-->
<!--    </select>-->

<!--    &lt;!&ndash;    用户积分收支记录查询记录条数&ndash;&gt;-->
<!--    <select id="showUserIntegralInfoCount" resultType="java.lang.Long" parameterType="com.example.papersmagboot.javabean.UserIntegralPage">-->
<!--        select count(*) from integraltable in1 left join usertable u on in1.uid = u.userid-->
<!--    </select>-->




</mapper>